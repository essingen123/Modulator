{"version":3,"sources":["webpack:///webpack/bootstrap 1fe244e1b3b98c16f5bb","webpack:///./ts/main.ts","webpack:///./ts/graph.ts"],"names":["Graph","Graph.constructor","Graph.arrowColor","Graph.addNode","Graph.draw","Node","Node.constructor","Node.addInput","GraphInteraction","GraphInteraction.constructor","GraphInteraction.setupConnectHandler","GraphInteraction.setupDnD","GraphDraw","GraphDraw.constructor","GraphDraw.draw","GraphDraw.clearCanvas","GraphDraw.drawArrow","GraphDraw.drawArrowTip","GraphDraw.getNodeCenter"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1fe244e1b3b98c16f5bb\n **/","import { Graph, Node } from './graph';\n\nconst gr = new Graph(<HTMLCanvasElement>$('#graph-canvas')[0]);\n\nconst tmp = $('<div>').addClass('arrow');\n$('body').append(tmp);\ngr.arrowColor = tmp.css('color');\ntmp.remove();\n\nconst n1 = new Node(10, 10);\nconst n2 = new Node(30, 100);\nconst n3 = new Node(60, 200);\ngr.addNode(n1);\ngr.addNode(n2);\ngr.addNode(n3);\nn1.addInput(n2);\nn2.addInput(n3);\ngr.draw();\n\n$('.palette > .node').click(evt => {\n\tconst n = new Node(260, 180);\n\tgr.addNode(n);\n});\n\n\n/** WEBPACK FOOTER **\n ** ./ts/main.ts\n **/","export class Graph {\n\n\tnodeCanvas: JQuery;\n\tnodes: Node[] = [];\n\tgraphDraw: GraphDraw;\n\tgraphInteract: GraphInteraction;\n\n\tconstructor(canvas: HTMLCanvasElement) {\n\t\tthis.nodeCanvas = $(canvas.parentElement);\n\t\tthis.graphDraw = new GraphDraw(canvas.getContext('2d'), canvas);\n\t\tthis.graphInteract = new GraphInteraction(this.nodeCanvas);\n\t}\n\n\tset arrowColor(color: string) {\n\t\tthis.graphDraw.arrowColor = color;\n\t}\n\n\taddNode(n: Node) {\n\t\tn.element = $('<div>')\n\t\t.addClass('node')\n\t\t.css({ left: n.x, top: n.y });\n\t\tthis.nodeCanvas.append(n.element);\n\t\tthis.nodes.push(n);\n\t\tthis.graphInteract.setupDnD(n, () => this.draw());\n\t\tthis.draw();\n\t}\n\n\tdraw() {\n\t\tthis.graphDraw.draw(this.nodes);\n\t}\n\n}\n\n\n/**\n * A node in a graph. Nodes can be connected to other nodes.\n */\nexport class Node {\n\tx: number;\n\ty: number;\n\tinputs: Node[] = [];\n\telement: JQuery;\n\tw: number;\n\th: number;\n\n\tconstructor(x: number, y: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\t/**\n\t * Connects two nodes by adding a given node as input.\n\t * Warning: nodes should be connected only after they have been added to the graph.\n\t * @param n the node to connect as input\n\t */\n\taddInput(n: Node) {\n\t\tthis.inputs.push(n);\n\t}\n\n}\n\n\n//------------------------- Privates -------------------------\n\nclass GraphInteraction {\n\n\tnodeCanvas: JQuery;\n\tmouseInside = false;\n\n\tconstructor(nodeCanvas: JQuery) {\n\t\tthis.nodeCanvas = nodeCanvas;\n\t\tthis.setupConnectHandler();\n\t}\n\n\tsetupConnectHandler() {\n\t\tthis.nodeCanvas.mouseenter(evt => this.mouseInside = true);\n\t\tthis.nodeCanvas.mouseleave(evt => this.mouseInside = false);\n\t\t$('body').keydown(evt => {\n\t\t\tif (evt.keyCode != 16) return;\n\t\t\tif (this.mouseInside) this.nodeCanvas.css('cursor', 'crosshair');\n\t\t})\n\t\t.keyup(evt => {\n\t\t\tif (evt.keyCode == 16) this.nodeCanvas.css('cursor', '');\n\t\t});\n\t}\n\n\tsetupDnD(n: Node, draw: () => void) {\n\t\tn.element.draggable({\n\t\t\tcontainment: 'parent',\n\t\t\tcursor: 'move',\n\t\t\tdistance: 5,\n\t\t\tstack: '.node',\n\t\t\tdrag: (event, ui) => {\n\t\t\t\tn.x = ui.position.left;\n\t\t\t\tn.y = ui.position.top;\n\t\t\t\tdraw();\n\t\t\t}\n\t\t});\n\t}\n}\n\n\ninterface Point {\n\tx: number,\n\ty: number\n}\n\n\nclass GraphDraw {\n\n\tgc: CanvasRenderingContext2D;\n\tcanvas: HTMLCanvasElement;\n\tarrowColor: string = \"black\";\n\n\tconstructor(gc: CanvasRenderingContext2D, canvas: HTMLCanvasElement) {\n\t\tthis.gc = gc;\n\t\tthis.canvas = canvas;\n\t}\n\n\tdraw(nodes: Node[]) {\n\t\tthis.clearCanvas();\n\t\tthis.gc.strokeStyle = this.arrowColor;\n\t\tthis.gc.lineWidth = 2;\n\t\tfor (const ndst of nodes)\n\t\t\tfor (const nsrc of ndst.inputs)\n\t\t\t\tthis.drawArrow(nsrc, ndst);\n\t}\n\n\tclearCanvas() {\n\t\tthis.gc.clearRect(0, 0, this.canvas.width, this.canvas.height);\n\t}\n\n\tdrawArrow(srcNode: Node, dstNode: Node) {\n\t\tconst srcPoint = this.getNodeCenter(srcNode);\n\t\tconst dstPoint = this.getNodeCenter(dstNode);\n\t\tthis.gc.beginPath();\n\t\tthis.gc.moveTo(srcPoint.x, srcPoint.y);\n\t\tthis.gc.lineTo(dstPoint.x, dstPoint.y);\n\t\tthis.drawArrowTip(srcPoint, dstPoint);\n\t\tthis.gc.closePath();\n\t\tthis.gc.stroke();\n\t}\n\n\tdrawArrowTip(src: Point, dst: Point) {\n\t\tconst posCoef = 0.6;\n\t\tconst mx = src.x + (dst.x - src.x) * posCoef;\n\t\tconst my = src.y + (dst.y - src.y) * posCoef;\n\t\tconst headlen = 10;\n\t\tvar angle = Math.atan2(dst.y - src.y, dst.x - src.x);\n\t\tthis.gc.moveTo(mx, my);\n\t\tthis.gc.lineTo(\n\t\t\tmx - headlen * Math.cos(angle - Math.PI/6),\n\t\t\tmy - headlen * Math.sin(angle - Math.PI/6)\n\t\t);\n\t\tthis.gc.moveTo(mx, my);\n\t\tthis.gc.lineTo(\n\t\t\tmx - headlen * Math.cos(angle + Math.PI/6),\n\t\t\tmy - headlen * Math.sin(angle + Math.PI/6)\n\t\t);\n\t}\n\n\tgetNodeCenter(n: Node): Point {\n\t\tn.w = n.w || n.element.outerWidth();\n\t\tn.h = n.h || n.element.outerHeight();\n\t\treturn { x: n.x + n.w / 2, y: n.y + n.h / 2 };\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./ts/graph.ts\n **/"],"sourceRoot":""}